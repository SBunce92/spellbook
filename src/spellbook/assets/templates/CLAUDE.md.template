# {{vault_dir}}

Spellbook vault v{{version}}

## Quick Start

```bash
ccv   # Run Claude from vault directory
```

Spellbook activates automatically when Claude runs from this directory.

## How It Works

1. **Stop hook** captures sessions to `buffer/` automatically
2. **Librarian** retrieves knowledge from `log/` + `index.db` on demand
3. **Archivist** processes `buffer/` â†’ `log/` when triggered

## Agent Routing (MANDATORY)

**NEVER access vault data directly. ALWAYS delegate to agents:**

- Do NOT use Read/Glob/Grep on `log/`, `buffer/`, or `index.db`
- Do NOT manually query SQLite or read archived documents
- ALWAYS use the Task tool with the appropriate agent below

| Trigger | Agent | Purpose |
|---------|-------|---------|
| Vault queries, "what do we know" | **ğŸ“š Librarian** | Deep retrieval + synthesis |
| Timeline, "when did we discuss" | **ğŸ“š Librarian** | Historical queries |
| Quick fact lookup | **ğŸ” Researcher** | Fast 2-3 sentence answer |
| "archive the buffer" | **ğŸ“œ Archivist** | Process buffer â†’ log |
| "audit", "dead code" | **ğŸ‘» Specter** | Code quality scan |
| Options/trading/Greeks | **ğŸ“ˆ Trader** | Domain expertise |
| ML/LLM/RAG questions | **ğŸ¤– AI Engineer** | Domain expertise |
| Data pipelines/SQL | **ğŸ—„ï¸ Data Engineer** | Domain expertise |
| Numerical/stats | **ğŸ“Š Quant Dev** | Domain expertise |

## Vault Structure

```
.claude/
  settings.json  # Hook registration (managed by sb update)
  agents/        # Subagent definitions
  hooks/         # Hook scripts
  scripts/       # Utility scripts
log/             # Archived documents (source of truth)
buffer/          # Pending session transcripts
index.db         # SQLite entity index (rebuildable)
```

## CLI

| Command | Description |
|---------|-------------|
| `sb status` | Check vault status (buffer count, entities, docs) |
| `sb update` | Update managed files to latest version |
| `sb rebuild` | Rebuild index.db from log/ |

## Entity Types

Documents in `log/` tag entities in YAML frontmatter:

```yaml
---
type: decision
date: 2025-12-24
entities:
  person: [Samuel Bunce]
  project: [spellbook]
  tool: [Claude Code]
  repo: [sb-vault]
  concept: [knowledge graphs]
  org: [Anthropic]
---
```

## Agents

**Core:**
- **ğŸ“œ Archivist** - Process buffer â†’ log, extract entities
- **ğŸ“š Librarian** - Deep retrieval, synthesize answers with citations
- **ğŸ” Researcher** - Fast factual lookup (2-3 sentences)
- **ğŸ‘» Specter** - Dead code audit, quality issues

**Domain:**
- **ğŸ“ˆ Trader** - Options, derivatives, Greeks, risk
- **ğŸ¤– AI Engineer** - ML systems, LLM integration, RAG
- **ğŸ—„ï¸ Data Engineer** - Pipelines, ClickHouse, ETL
- **ğŸ“Š Quant Dev** - Numerical computing, statistics
