# {{vault_dir}}

Spellbook vault v{{version}}

## Quick Start

```bash
ccv   # Run Claude from vault directory
```

Spellbook activates automatically when Claude runs from this directory.

## How It Works

1. **Stop hook** captures exchanges to `buffer/` automatically
2. **General** orchestrates all tasks, delegating to specialists
3. **Specialists** handle domain-specific work (retrieval, analysis, etc.)
4. **Archivist** processes `buffer/` â†’ `log/` to persist knowledge

## Task Routing (MANDATORY)

**Route ALL non-trivial tasks through the General orchestrator.**

```
Task(subagent_type="general-purpose", prompt="your task here")
```

General will:
- Analyze the request
- Delegate to appropriate specialists
- Run parallel tasks when possible
- Synthesize results
- **Ensure archiving happens** (checks buffer, invokes Archivist)

**Do NOT:**
- Directly invoke specialists (Librarian, Trader, etc.) - let General route
- Access vault data directly (log/, buffer/, index.db) - agents handle this
- Skip the orchestration layer for complex tasks

**Exception:** Trivial interactions (greetings, simple clarifications) need no agent.

## Archiving Protocol (MANDATORY)

The stop hook captures exchanges automatically. General MUST invoke Archivist at the end of every substantive task:

1. Check buffer: `ls buffer/*.txt 2>/dev/null | wc -l`
2. If count > 0: `Task(subagent_type="archivist", prompt="Process buffer")`
3. This is NON-NEGOTIABLE

## Vault Structure

```
.claude/
  settings.json  # Hook registration (managed by sb update)
  agents/        # Subagent definitions
  hooks/         # Hook scripts
  scripts/       # Utility scripts
log/             # Archived documents (source of truth)
buffer/          # Pending exchange captures
index.db         # SQLite entity index (rebuildable)
```

## CLI

| Command | Description |
|---------|-------------|
| `sb status` | Check vault status (buffer count, entities, docs) |
| `sb update` | Update managed files to latest version |
| `sb rebuild` | Rebuild index.db from log/ |

## Entity Types

Documents in `log/` tag entities in YAML frontmatter:

```yaml
---
type: decision
date: 2025-12-24
entities:
  person: [Samuel Bunce]
  project: [spellbook]
  tool: [Claude Code]
  concept: [knowledge graphs]
---
```

## Agents

**Orchestrator:**
- **ğŸ¯ General** - Central coordinator, delegates to specialists, ensures archiving

**Core:**
- **ğŸ“œ Archivist** - Process buffer â†’ log, extract entities
- **ğŸ“š Librarian** - Deep retrieval, synthesize answers with citations
- **ğŸ” Researcher** - Fast factual lookup (2-3 sentences)
- **ğŸ‘» Specter** - Dead code audit, quality issues

**Domain:**
- **ğŸ“ˆ Trader** - Options, derivatives, Greeks, risk
- **ğŸ¤– AI Engineer** - ML systems, LLM integration, RAG
- **ğŸ—„ï¸ Data Engineer** - Pipelines, ClickHouse, ETL
- **ğŸ“Š Quant Dev** - Numerical computing, statistics
