# {{vault_dir}}

Spellbook vault v{{version}}

## Quick Start

```bash
ccv   # Run Claude from vault directory
```

Spellbook activates automatically when Claude runs from this directory.

## How It Works

1. **Stop hook** captures sessions to `buffer/` automatically
2. **Librarian** retrieves knowledge from `log/` + `index.db` on demand
3. **Archivist** processes `buffer/` → `log/` when triggered

## Agent Routing

**Automatically delegate to these agents when relevant:**

| Trigger | Agent | Purpose |
|---------|-------|---------|
| "what do we know about X" | **librarian** | Deep retrieval + synthesis |
| "when did we discuss X" | **librarian** | Timeline queries |
| "quick lookup on X" | **researcher** | Fast 2-3 sentence answer |
| "archive the buffer" | **archivist** | Process buffer → log |
| "audit", "dead code" | **specter** | Code quality scan |
| Options/trading/Greeks | **trader** | Domain expertise |
| ML/LLM/RAG questions | **ai-engineer** | Domain expertise |
| Data pipelines/SQL | **data-engineer** | Domain expertise |
| Numerical/stats | **quant-dev** | Domain expertise |

## Vault Structure

```
.claude/
  settings.json  # Hook registration (managed by sb update)
  agents/        # Subagent definitions
  hooks/         # Hook scripts
  scripts/       # Utility scripts
log/             # Archived documents (source of truth)
buffer/          # Pending session transcripts
index.db         # SQLite entity index (rebuildable)
```

## CLI

| Command | Description |
|---------|-------------|
| `sb status` | Check vault status (buffer count, entities, docs) |
| `sb update` | Update managed files to latest version |
| `sb rebuild` | Rebuild index.db from log/ |

## Entity Types

Documents in `log/` tag entities in YAML frontmatter:

```yaml
---
type: decision
date: 2025-12-24
entities:
  person: [Samuel Bunce]
  project: [spellbook]
  tool: [Claude Code]
  repo: [sb-vault]
  concept: [knowledge graphs]
  org: [Anthropic]
---
```

## Agents

**Core:**
- **archivist** - Process buffer → log, extract entities
- **librarian** - Deep retrieval, synthesize answers with citations
- **researcher** - Fast factual lookup (2-3 sentences)
- **specter** - Dead code audit, quality issues

**Domain:**
- **trader** - Options, derivatives, Greeks, risk
- **ai-engineer** - ML systems, LLM integration, RAG
- **data-engineer** - Pipelines, ClickHouse, ETL
- **quant-dev** - Numerical computing, statistics
